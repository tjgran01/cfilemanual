# Table of Contents
1. [Preface / Resources](#preface--resources)
2. [Creating Conditions Files](#creating-conditions-files)
    - [What is a Conditions File?](#what-is-a-conditions-file)
    - [Naming Conventions](#naming-conventions)
    - [Samples](#samples)
    - [Useful Scripts](#useful-scripts)
3. [Example Conditions Files](#example-conditions-file)
    - [Task](#task)
    - [Stim](#stim)
    - [Onset](#onset)
    - [Duration](#duration)
    - [Putting it All Together](#putting-it-all-together)
4. [Adding Self Report Data To A Conditions File](#adding-self-report-data-to-a-conditions-file)

# Preface / Resources:

The information in this manual has been culled from both personal experience as well as from various reference manuals for the sensors generally used in the MIND lab – if there is a question that you have that you find not addressed in this manual feel free to look over the following resources to see if you question can be answered, or feel free to contact this manual’s author, Trevor Grant, at tjgran01@syr.edu.

# Creating Conditions Files.

## What is a conditions file?

The code used for analysis needs more than just a raw data file in order to do the type of analysis needed in many of our experiments. During data collection *marks* are received by the various sensors at various times to help us keep track of what sections of the data reflect the participant undergoing various tasks. A conditions file is used by the analysis code to look at only the sections of data we are interested in analyzing at a given time.

For example – say you were viewing a participant’s heart rate during periods of stressful stimuli vs. periods of non-stressful stimuli. In order to perform an accurate analysis, you would need to view all of the times the participant was exposed to stressful stimuli and compare it against the times in which they were exposed to a non-stressful stimuli, and then analyze the data file to see if there was a significant difference in their physiological response (in this case in their heart rate).

In order to perform the above analysis, you will need three things – the ***onset** of the stimulus*, the ***duration** of the stimulus* and, something to identify *what the stimulus (**stim**) was*. The three bolded words in the prior sentence are needed in every conditions file, and as a result will be the first three rows generated in every conditions file made.

The other data included in a conditions file are generated by the participant’s self-reports which may have been administered throughout an experiment or after the physiological data has been collected. Typically, these data are in the form of survey questions, though they can take other forms. We will first discuss how to generate the onset, duration and stim rows of a conditions file, after we will discuss how to include the participant’s self-report in the file.

## Naming conventions.

In order to ensure that the code used for analysis is able to find the right conditions file
to match the corresponding physiological data file three pieces of information need to be
included in the name of the conditions file.

1. The participant's anonymized ID: `8109`
  - Currently in the lab we use four digit IDs for each participant in a study. The first two
  digits corresponding to the study, and the second two corresponding to the participant.
  For example the participant ID 8109 would tell us that the experiment ID is '81' and the
  ID for the participant in that study was '09'.

2. The sensor that conditions file is for. `FNIRS`
  - Different sensors have different sampling frequencies (the FNIRS, for example, takes operates
    at 6Hz, meaning it takes 100 samples per second, whereas BIOPAC sensors operate at 60Hz, and
    take 1000 samples per second). Because of the differences in sampling frequencies, and
    experimental limitations (i.e. if the sensors are unable to be started simultaneously and are therefore out of sync with one another) sensor type must be included in the name of the conditions file. **Even in cases in which your experiment only uses one sensor**.

    - Note: The reason sensor type must always be included is because if cross experimental analysis is to be done later on the data you have collected the code needs to know
    what type of data it is looking at. It always pays to think ahead. Plus, it makes the
    database look prettier and scripting easier.

3. The session number. `s1`
  - Many experiments include multiple sessions. Whether it's because the experiment is
  long, and forcing a participant to wear the sensors for an extended period leads to
  discomfort, or because certain experimental designs require a participant rest between two
  sets of stimuli. For the reasons mentioned in the sensor section, always include a session
  number in your condition's file name. Session numbers are included at the end of the filename
  before the file extension (.csv), and are prepended by a 's'.

Putting these three pieces of information together with some basic syntax yields a file
name that looks like this:

`8109_FNIRS_conditions_s1.csv`

Generically:

`{participantID}_{sensortype}_conditions_s{session_number}.csv`

### Samples

For sample conditions files with proper naming conventions navigate to:
`./cfilemanual/scripts/python/exports/sample_exports/` in this repository.

### Useful Scripts

`./cfilemanual/scripts/python/mkctemp.py` will automate this process for the user. For details
and further informations view the script's documentation in `./cfilemanual/scrips/README.md`.

# Example Conditions File:

*Figure1-1*

![Figure1-1](https://github.com/tjgran01/cfilemanual/blob/master/cfilemanual/img/fig1-1.png)

Pictured above is an example of a properly formatted conditions file. With only the onset, duration and stim listed for five tasks. Let’s go through and explain what all of these numbers and headings mean.

### Task

*Figure1-2*

![Figure1-2](https://github.com/tjgran01/cfilemanual/blob/master/cfilemanual/img/fig1-2.png)

A task column indicates that the participant was exposed to a stimulus, or had undergone a set of circumstances that we are interested in analyzing. In the example listed in the introduction of this chapter – both the period of viewing stressful stimuli and viewing non-stressful stimuli are each considered separate tasks and would therefore each be given their own column in a conditions file.

### Onset

*Figure1-3*

![Figure1-3](https://github.com/tjgran01/cfilemanual/blob/master/cfilemanual/img/fig1-3.png)

The onset row indicates the row number in the data file where the participant was first subjected to each task. Continuing with our example from above we can see that the participant first experienced the Task1 at row 355 in the data file. This means that if we bring up the data file and view row 355 – we can know that this is the physiological data we are interested in for our analysis begins.

### Duration

*Figure1-4*

![Figure1-4](https://github.com/tjgran01/cfilemanual/blob/master/cfilemanual/img/fig1-4.png)

Duration: The duration row indicates the number of rows in the data file in which a task took place. In the example above, we see that Task1 took place for 200 rows of data in the data file, whereas Task3 took 300 rows of data. The onset together with the duration show us chunks of data in the data file that relate to the task we are interested in analyzing.

* Note: durations can and oftentimes are the same amount of time for each task, such as a participant viewing 60 seconds of different advertisements. However, this is not always the case. Some tasks may be self-paced, such as a participant completing a puzzle, while other tasks may be longer than others in certain experiments, such as viewing an advertisement that is 20 seconds long compared to an advertisement that is 25 seconds long.

### Stim

*Figure1-5*

![Figure1-5](https://github.com/tjgran01/cfilemanual/blob/master/cfilemanual/img/fig1-5.png)

The first two rows of the conditions file tell us where and how long a task takes place in a data file. The stim row tells us what the participant was undergoing. In the example in the introduction the stim row would tell us whether the participant was undergoing stressful stimuli or non-stressful stimuli. You’ll note that the stim row is filled with numbers, rather than descriptors, when creating a conditions file you we be responsible for creating a key that determines what number corresponds to which stimulus. In the above example, 1 represents a non-stressful stimulus, 2 represents a stressful stimulus, and 3 represents a rest period.

## Putting it all together:

Before we move on and look at how to include a participant’s self-report in a conditions file let’s look at this simple conditions file below and see what we know about the experiment based on these three rows alone.

*Figure1-6*

![Figure1-6](https://github.com/tjgran01/cfilemanual/blob/master/cfilemanual/img/fig1-6.png)

1. We can see that the participant underwent 5 tasks by viewing the number of columns.
2. We know that there are 3 types of tasks by viewing the three different numbers in the stim rows.
3. We know that the rest stim was longer than the stressful and non-stressful stims because the durations for a task with a 3 in the stim cell are higher than those tasks with a 1 or a 2 in the stim cell.

# Adding Self-Report Data to a Conditions File

Though the onset, duration, and stim rows of a conditions file tell us a great deal about what took
place during an experiment, and point the analysis code to the proper place in the raw data files,
there is another step that must be taken to make conditions files more robust. This next step
involves including data that participants generate through self-reporting their subjective measures
throughout the experiment, most commonly in the form of surveys taken by participants throughout
as well as after an experiment. This manual will discuss how to collect and obtain this data using
the software Qualtrics. If there is another survey software you prefer, such as SurveyMonkey, the
steps may be different, but the measures, and the process of including those measures in a
conditions file will be the same. Let’s first look at an example of a more complete conditions
file than the one we saw in the last section.

* Note - it is recommended that an experimenter use Qualtrics for obtaining subjective measures.
The scripts for automatically generating conditions files contained with in this repository utilize
the Qualtrics API in order to match the stim, onset, and duration values with the survey data stored
on a Qualtrics account. If you plan on generating the conditions files 'by hand', then this manual
can be considered agnostic.

*Figure1-7*

![Figure1-7](https://github.com/tjgran01/cfilemanual/blob/master/cfilemanual/img/fig1-7.png)

The most obvious difference between the conditions file in Figure 1-7 and the conditions file in
the previous section is that it includes more data – more data in the form of more rows. The
original onset, duration, and stim rows have remained unaltered. The only difference is that each
task now has a row dedicated to a participant’s response to a survey question that was asked about
the task they had just undergone. Many experiments at the MIND lab follow the general pattern of:

1. Putting a participant through a task.
2. Administering a survey directly after the task, asking survey questions with reference to the task they have just completed.
